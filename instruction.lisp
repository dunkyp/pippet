(in-package :cl-user)
(defpackage #:pippet/instruction
  (:use #:cl
        #:uiop)
  (:export #:operand
           #:instruction
           #:decode-instruction
           #:instruction-mnemonic #:instruction-bytes
           #:instruction-operands
           #:operand-name #:operand-immediate
           #:operand-bytes
           ; OPCODES
           #:NOP #:LD #:JP #:JR #:INC #:DEC
           #:ADD #:SUB #:RLA #:RLCA
           ; REGISTERS
           #:A #:B #:C #:D #:E #:F #:H #:L
           #:AF #:BC #:DE #:HL #:SP #:PC
           ; MEMORY
           #:a8 #:a16 #:d8 #:d16
           #:ZERO #:CARRY #:NOT-ZERO #:NOT-CARRY
           #:assemble #:*instruction-map*))
(in-package #:pippet/instruction)

(defstruct operand
  name
  immediate
  bytes
  increment
  decrement)

(defstruct instruction
  mnemonic
  bytes
  cycles
  immediate
  zero
  subtraction
  half-carry
  carry
  operands
  position
)

(deftype uint8 () '(unsigned-byte 8))

(defun decode-instruction (opcode)
  "Gets instruction from opcode"
  (typecase opcode
    (string "a string")
    (uint8 (aref +INSTRUCTIONS+ opcode))
    (t (error opcode))))

(defun aref-or-nil (array ref)
  (or (if (< ref (length array))
          (aref array ref))
      (make-operand)))

(defparameter +INSTRUCTIONS+
  (vector
   (make-instruction :mnemonic 'NOP :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 0)
   (make-instruction :mnemonic 'LD :bytes 3 :cycles 12 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'BC :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'd16 :immediate t :bytes 2 :increment nil :decrement nil)) :position 1)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'BC :immediate nil :bytes 0 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 2)
   (make-instruction :mnemonic 'INC :bytes 1 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'BC :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 3)
   (make-instruction :mnemonic 'INC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 4)
   (make-instruction :mnemonic 'DEC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 5)
   (make-instruction :mnemonic 'LD :bytes 2 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 6)
   (make-instruction :mnemonic 'RLCA :bytes 1 :cycles 4 :immediate t :zero 'UNSET :subtraction 'UNSET :half-carry 'UNSET :carry 'MAY_SET :operands #(nil nil) :position 7)
   (make-instruction :mnemonic 'LD :bytes 3 :cycles 20 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'a16 :immediate nil :bytes 2 :increment nil :decrement nil) (make-operand :name 'SP :immediate t :bytes 0 :increment nil :decrement nil)) :position 8)
   (make-instruction :mnemonic 'ADD :bytes 1 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'HL :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'BC :immediate t :bytes 0 :increment nil :decrement nil)) :position 9)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'BC :immediate nil :bytes 0 :increment nil :decrement nil)) :position 10)
   (make-instruction :mnemonic 'DEC :bytes 1 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'BC :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 11)
   (make-instruction :mnemonic 'INC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 12)
   (make-instruction :mnemonic 'DEC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 13)
   (make-instruction :mnemonic 'LD :bytes 2 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 14)
   (make-instruction :mnemonic 'RRCA :bytes 1 :cycles 4 :immediate t :zero 'UNSET :subtraction 'UNSET :half-carry 'UNSET :carry 'MAY_SET :operands #(nil nil) :position 15)
   (make-instruction :mnemonic 'STOP :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 16)
   (make-instruction :mnemonic 'LD :bytes 3 :cycles 12 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'DE :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'd16 :immediate t :bytes 2 :increment nil :decrement nil)) :position 17)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'DE :immediate nil :bytes 0 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 18)
   (make-instruction :mnemonic 'INC :bytes 1 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'DE :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 19)
   (make-instruction :mnemonic 'INC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 20)
   (make-instruction :mnemonic 'DEC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 21)
   (make-instruction :mnemonic 'LD :bytes 2 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 22)
   (make-instruction :mnemonic 'RLA :bytes 1 :cycles 4 :immediate t :zero 'UNSET :subtraction 'UNSET :half-carry 'UNSET :carry 'MAY_SET :operands #(nil nil) :position 23)
   (make-instruction :mnemonic 'JR :bytes 2 :cycles 12 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'r8 :immediate t :bytes 1 :increment nil :decrement nil) nil) :position 24)
   (make-instruction :mnemonic 'ADD :bytes 1 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'HL :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'DE :immediate t :bytes 0 :increment nil :decrement nil)) :position 25)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'DE :immediate nil :bytes 0 :increment nil :decrement nil)) :position 26)
   (make-instruction :mnemonic 'DEC :bytes 1 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'DE :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 27)
   (make-instruction :mnemonic 'INC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 28)
   (make-instruction :mnemonic 'DEC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 29)
   (make-instruction :mnemonic 'LD :bytes 2 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 30)
   (make-instruction :mnemonic 'RRA :bytes 1 :cycles 4 :immediate t :zero 'UNSET :subtraction 'UNSET :half-carry 'UNSET :carry 'MAY_SET :operands #(nil nil) :position 31)
   (make-instruction :mnemonic 'JR :bytes 2 :cycles 12 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'NOT-ZERO :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'r8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 32)
   (make-instruction :mnemonic 'LD :bytes 3 :cycles 12 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'd16 :immediate t :bytes 2 :increment nil :decrement nil)) :position 33)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment t :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 34)
   (make-instruction :mnemonic 'INC :bytes 1 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 35)
   (make-instruction :mnemonic 'INC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 36)
   (make-instruction :mnemonic 'DEC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 37)
   (make-instruction :mnemonic 'LD :bytes 2 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 38)
   (make-instruction :mnemonic 'DAA :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNTOUCHED :half-carry 'UNSET :carry 'MAY_SET :operands #(nil nil) :position 39)
   (make-instruction :mnemonic 'JR :bytes 2 :cycles 12 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'ZERO :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'r8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 40)
   (make-instruction :mnemonic 'ADD :bytes 1 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'HL :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'HL :immediate t :bytes 0 :increment nil :decrement nil)) :position 41)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'HL :immediate nil :bytes 0 :increment t :decrement nil)) :position 42)
   (make-instruction :mnemonic 'DEC :bytes 1 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 43)
   (make-instruction :mnemonic 'INC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 44)
   (make-instruction :mnemonic 'DEC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 45)
   (make-instruction :mnemonic 'LD :bytes 2 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 46)
   (make-instruction :mnemonic 'CPL :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'SET :half-carry 'SET :carry 'UNTOUCHED :operands #(nil nil) :position 47)
   (make-instruction :mnemonic 'JR :bytes 2 :cycles 12 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'NOT-CARRY :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'r8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 48)
   (make-instruction :mnemonic 'LD :bytes 3 :cycles 12 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'SP :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'd16 :immediate t :bytes 2 :increment nil :decrement nil)) :position 49)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement t) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 50)
   (make-instruction :mnemonic 'INC :bytes 1 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'SP :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 51)
   (make-instruction :mnemonic 'INC :bytes 1 :cycles 12 :immediate nil :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil) nil) :position 52)
   (make-instruction :mnemonic 'DEC :bytes 1 :cycles 12 :immediate nil :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil) nil) :position 53)
   (make-instruction :mnemonic 'LD :bytes 2 :cycles 12 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil) (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 54)
   (make-instruction :mnemonic 'SCF :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNSET :half-carry 'UNSET :carry 'SET :operands #(nil nil) :position 55)
   (make-instruction :mnemonic 'JR :bytes 2 :cycles 12 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'CARRY :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'r8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 56)
   (make-instruction :mnemonic 'ADD :bytes 1 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'HL :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'SP :immediate t :bytes 0 :increment nil :decrement nil)) :position 57)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement t)) :position 58)
   (make-instruction :mnemonic 'DEC :bytes 1 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'SP :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 59)
   (make-instruction :mnemonic 'INC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 60)
   (make-instruction :mnemonic 'DEC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 61)
   (make-instruction :mnemonic 'LD :bytes 2 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 62)
   (make-instruction :mnemonic 'CCF :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNSET :half-carry 'UNSET :carry 'MAY_SET :operands #(nil nil) :position 63)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil)) :position 64)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil)) :position 65)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil)) :position 66)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil)) :position 67)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil)) :position 68)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil)) :position 69)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil)) :position 70)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 71)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil)) :position 72)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil)) :position 73)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil)) :position 74)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil)) :position 75)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil)) :position 76)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil)) :position 77)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil)) :position 78)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 79)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil)) :position 80)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil)) :position 81)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil)) :position 82)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil)) :position 83)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil)) :position 84)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil)) :position 85)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil)) :position 86)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 87)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil)) :position 88)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil)) :position 89)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil)) :position 90)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil)) :position 91)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil)) :position 92)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil)) :position 93)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil)) :position 94)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 95)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil)) :position 96)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil)) :position 97)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil)) :position 98)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil)) :position 99)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil)) :position 100)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil)) :position 101)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil)) :position 102)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 103)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil)) :position 104)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil)) :position 105)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil)) :position 106)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil)) :position 107)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil)) :position 108)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil)) :position 109)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil)) :position 110)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 111)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil) (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil)) :position 112)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil) (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil)) :position 113)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil) (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil)) :position 114)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil) (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil)) :position 115)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil) (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil)) :position 116)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil) (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil)) :position 117)
   (make-instruction :mnemonic 'HALT :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 118)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 119)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil)) :position 120)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil)) :position 121)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil)) :position 122)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil)) :position 123)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil)) :position 124)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil)) :position 125)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil) nil) :position 126)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 127)
   (make-instruction :mnemonic 'ADD :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil)) :position 128)
   (make-instruction :mnemonic 'ADD :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 129)
   (make-instruction :mnemonic 'ADD :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil)) :position 130)
   (make-instruction :mnemonic 'ADD :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil)) :position 131)
   (make-instruction :mnemonic 'ADD :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil)) :position 132)
   (make-instruction :mnemonic 'ADD :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil)) :position 133)
   (make-instruction :mnemonic 'ADD :bytes 1 :cycles 8 :immediate nil :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil)) :position 134)
   (make-instruction :mnemonic 'ADD :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 135)
   (make-instruction :mnemonic 'ADC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil)) :position 136)
   (make-instruction :mnemonic 'ADC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil)) :position 137)
   (make-instruction :mnemonic 'ADC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil)) :position 138)
   (make-instruction :mnemonic 'ADC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil)) :position 139)
   (make-instruction :mnemonic 'ADC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil)) :position 140)
   (make-instruction :mnemonic 'ADC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil)) :position 141)
   (make-instruction :mnemonic 'ADC :bytes 1 :cycles 8 :immediate nil :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil)) :position 142)
   (make-instruction :mnemonic 'ADC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 143)
   (make-instruction :mnemonic 'SUB :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil)) :position 144)
   (make-instruction :mnemonic 'SUB :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil)) :position 145)
   (make-instruction :mnemonic 'SUB :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil)) :position 146)
   (make-instruction :mnemonic 'SUB :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil)) :position 147)
   (make-instruction :mnemonic 'SUB :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil)) :position 148)
   (make-instruction :mnemonic 'SUB :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil)) :position 149)
   (make-instruction :mnemonic 'SUB :bytes 1 :cycles 8 :immediate nil :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil)) :position 150)
   (make-instruction :mnemonic 'SUB :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 151)
   (make-instruction :mnemonic 'SBC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil)) :position 152)
   (make-instruction :mnemonic 'SBC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil)) :position 153)
   (make-instruction :mnemonic 'SBC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil)) :position 154)
   (make-instruction :mnemonic 'SBC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil)) :position 155)
   (make-instruction :mnemonic 'SBC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil)) :position 156)
   (make-instruction :mnemonic 'SBC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil)) :position 157)
   (make-instruction :mnemonic 'SBC :bytes 1 :cycles 8 :immediate nil :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil)) :position 158)
   (make-instruction :mnemonic 'SBC :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 159)
   (make-instruction :mnemonic 'AND :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'SET :carry 'UNSET :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 160)
   (make-instruction :mnemonic 'AND :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'SET :carry 'UNSET :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 161)
   (make-instruction :mnemonic 'AND :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'SET :carry 'UNSET :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 162)
   (make-instruction :mnemonic 'AND :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'SET :carry 'UNSET :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 163)
   (make-instruction :mnemonic 'AND :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'SET :carry 'UNSET :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 164)
   (make-instruction :mnemonic 'AND :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'SET :carry 'UNSET :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 165)
   (make-instruction :mnemonic 'AND :bytes 1 :cycles 8 :immediate nil :zero 'MAY_SET :subtraction 'UNSET :half-carry 'SET :carry 'UNSET :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil) nil) :position 166)
   (make-instruction :mnemonic 'AND :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'SET :carry 'UNSET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 167)
   (make-instruction :mnemonic 'XOR :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 168)
   (make-instruction :mnemonic 'XOR :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 169)
   (make-instruction :mnemonic 'XOR :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 170)
   (make-instruction :mnemonic 'XOR :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 171)
   (make-instruction :mnemonic 'XOR :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 172)
   (make-instruction :mnemonic 'XOR :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 173)
   (make-instruction :mnemonic 'XOR :bytes 1 :cycles 8 :immediate nil :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil)) :position 174)
   (make-instruction :mnemonic 'XOR :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 175)
   (make-instruction :mnemonic 'OR :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 176)
   (make-instruction :mnemonic 'OR :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 177)
   (make-instruction :mnemonic 'OR :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 178)
   (make-instruction :mnemonic 'OR :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 179)
   (make-instruction :mnemonic 'OR :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 180)
   (make-instruction :mnemonic 'OR :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 181)
   (make-instruction :mnemonic 'OR :bytes 1 :cycles 8 :immediate nil :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil)) :position 182)
   (make-instruction :mnemonic 'OR :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 183)
   (make-instruction :mnemonic 'CP :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'B :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 184)
   (make-instruction :mnemonic 'CP :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'C :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 185)
   (make-instruction :mnemonic 'CP :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'D :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 186)
   (make-instruction :mnemonic 'CP :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'E :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 187)
   (make-instruction :mnemonic 'CP :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'H :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 188)
   (make-instruction :mnemonic 'CP :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'L :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 189)
   (make-instruction :mnemonic 'CP :bytes 1 :cycles 8 :immediate nil :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'HL :immediate nil :bytes 0 :increment nil :decrement nil)) :position 190)
   (make-instruction :mnemonic 'CP :bytes 1 :cycles 4 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 191)
   (make-instruction :mnemonic 'RET :bytes 1 :cycles 20 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'NOT-ZERO :immediate t :bytes 0 :increment nil :decrement nil)) :position 192)
   (make-instruction :mnemonic 'POP :bytes 1 :cycles 12 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'BC :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 193)
   (make-instruction :mnemonic 'JP :bytes 3 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'NOT-ZERO :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'a16 :immediate t :bytes 2 :increment nil :decrement nil)) :position 194)
   (make-instruction :mnemonic 'JP :bytes 3 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'a16 :immediate t :bytes 2 :increment nil :decrement nil) nil) :position 195)
   (make-instruction :mnemonic 'CALL :bytes 3 :cycles 24 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'NOT-ZERO :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'a16 :immediate t :bytes 2 :increment nil :decrement nil)) :position 196)
   (make-instruction :mnemonic 'PUSH :bytes 1 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'BC :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 197)
   (make-instruction :mnemonic 'ADD :bytes 2 :cycles 8 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 198)
   (make-instruction :mnemonic 'RST :bytes 1 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name '00H :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 199)
   (make-instruction :mnemonic 'RET :bytes 1 :cycles 20 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'ZERO :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 200)
   (make-instruction :mnemonic 'RET :bytes 1 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 201)
   (make-instruction :mnemonic 'JP :bytes 3 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'ZERO :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'a16 :immediate t :bytes 2 :increment nil :decrement nil)) :position 202)
   (make-instruction :mnemonic 'PREFIX :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 203)
   (make-instruction :mnemonic 'CALL :bytes 3 :cycles 24 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'ZERO :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'a16 :immediate t :bytes 2 :increment nil :decrement nil)) :position 204)
   (make-instruction :mnemonic 'CALL :bytes 3 :cycles 24 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'a16 :immediate t :bytes 2 :increment nil :decrement nil) nil) :position 205)
   (make-instruction :mnemonic 'ADC :bytes 2 :cycles 8 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 206)
   (make-instruction :mnemonic 'RST :bytes 1 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name '08H :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 207)
   (make-instruction :mnemonic 'RET :bytes 1 :cycles 20 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'NOT-CARRY :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 208)
   (make-instruction :mnemonic 'POP :bytes 1 :cycles 12 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'DE :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 209)
   (make-instruction :mnemonic 'JP :bytes 3 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'NOT-CARRY :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'a16 :immediate t :bytes 2 :increment nil :decrement nil)) :position 210)
   (make-instruction :mnemonic 'ILLEGAL_D3 :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 211)
   (make-instruction :mnemonic 'CALL :bytes 3 :cycles 24 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'NOT-CARRY :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'a16 :immediate t :bytes 2 :increment nil :decrement nil)) :position 212)
   (make-instruction :mnemonic 'PUSH :bytes 1 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'DE :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 213)
   (make-instruction :mnemonic 'SUB :bytes 2 :cycles 8 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil) nil) :position 214)
   (make-instruction :mnemonic 'RST :bytes 1 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name '10H :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 215)
   (make-instruction :mnemonic 'RET :bytes 1 :cycles 20 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'CARRY :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 216)
   (make-instruction :mnemonic 'RETI :bytes 1 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 217)
   (make-instruction :mnemonic 'JP :bytes 3 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'CARRY :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'a16 :immediate t :bytes 2 :increment nil :decrement nil)) :position 218)
   (make-instruction :mnemonic 'ILLEGAL_DB :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 219)
   (make-instruction :mnemonic 'CALL :bytes 3 :cycles 24 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'CARRY :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'a16 :immediate t :bytes 2 :increment nil :decrement nil)) :position 220)
   (make-instruction :mnemonic 'ILLEGAL_DD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 221)
   (make-instruction :mnemonic 'SBC :bytes 2 :cycles 8 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 222)
   (make-instruction :mnemonic 'RST :bytes 1 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name '18H :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 223)
   (make-instruction :mnemonic 'LDH :bytes 2 :cycles 12 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'a8 :immediate nil :bytes 1 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 224)
   (make-instruction :mnemonic 'POP :bytes 1 :cycles 12 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 225)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'C :immediate nil :bytes 0 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 226)
   (make-instruction :mnemonic 'ILLEGAL_E3 :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 227)
   (make-instruction :mnemonic 'ILLEGAL_E4 :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 228)
   (make-instruction :mnemonic 'PUSH :bytes 1 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 229)
   (make-instruction :mnemonic 'AND :bytes 2 :cycles 8 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'SET :carry 'UNSET :operands (vector (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil) nil) :position 230)
   (make-instruction :mnemonic 'RST :bytes 1 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name '20H :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 231)
   (make-instruction :mnemonic 'ADD :bytes 2 :cycles 16 :immediate t :zero 'UNSET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'SP :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'r8 :immediate t :bytes 1 :increment nil :decrement nil)) :position 232)
   (make-instruction :mnemonic 'JP :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'HL :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 233)
   (make-instruction :mnemonic 'LD :bytes 3 :cycles 16 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'a16 :immediate nil :bytes 2 :increment nil :decrement nil) (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil)) :position 234)
   (make-instruction :mnemonic 'ILLEGAL_EB :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 235)
   (make-instruction :mnemonic 'ILLEGAL_EC :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 236)
   (make-instruction :mnemonic 'ILLEGAL_ED :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 237)
   (make-instruction :mnemonic 'XOR :bytes 2 :cycles 8 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil) nil) :position 238)
   (make-instruction :mnemonic 'RST :bytes 1 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name '28H :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 239)
   (make-instruction :mnemonic 'LDH :bytes 2 :cycles 12 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'a8 :immediate nil :bytes 1 :increment nil :decrement nil)) :position 240)
   (make-instruction :mnemonic 'POP :bytes 1 :cycles 12 :immediate t :zero 'MAY_SET :subtraction 'MAY_SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'AF :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 241)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'C :immediate nil :bytes 0 :increment nil :decrement nil)) :position 242)
   (make-instruction :mnemonic 'DI :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 243)
   (make-instruction :mnemonic 'ILLEGAL_F4 :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 244)
   (make-instruction :mnemonic 'PUSH :bytes 1 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'AF :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 245)
   (make-instruction :mnemonic 'OR :bytes 2 :cycles 8 :immediate t :zero 'MAY_SET :subtraction 'UNSET :half-carry 'UNSET :carry 'UNSET :operands (vector (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil) nil) :position 246)
   (make-instruction :mnemonic 'RST :bytes 1 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name '30H :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 247)
   (make-instruction :mnemonic 'LD :bytes 2 :cycles 12 :immediate t :zero 'UNSET :subtraction 'UNSET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'HL :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'SP :immediate t :bytes 0 :increment t :decrement nil)) :position 248)
   (make-instruction :mnemonic 'LD :bytes 1 :cycles 8 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'SP :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'HL :immediate t :bytes 0 :increment nil :decrement nil)) :position 249)
   (make-instruction :mnemonic 'LD :bytes 3 :cycles 16 :immediate nil :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name 'A :immediate t :bytes 0 :increment nil :decrement nil) (make-operand :name 'a16 :immediate nil :bytes 2 :increment nil :decrement nil)) :position 250)
   (make-instruction :mnemonic 'EI :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 251)
   (make-instruction :mnemonic 'ILLEGAL_FC :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 252)
   (make-instruction :mnemonic 'ILLEGAL_FD :bytes 1 :cycles 4 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands #(nil nil) :position 253)
   (make-instruction :mnemonic 'CP :bytes 2 :cycles 8 :immediate t :zero 'MAY_SET :subtraction 'SET :half-carry 'MAY_SET :carry 'MAY_SET :operands (vector (make-operand :name 'd8 :immediate t :bytes 1 :increment nil :decrement nil) nil) :position 254)
   (make-instruction :mnemonic 'RST :bytes 1 :cycles 16 :immediate t :zero 'UNTOUCHED :subtraction 'UNTOUCHED :half-carry 'UNTOUCHED :carry 'UNTOUCHED :operands (vector (make-operand :name '38H :immediate t :bytes 0 :increment nil :decrement nil) nil) :position 255)))

(defparameter *instruction-map* (make-hash-table :test 'equal))
(loop for i from 0
   for instruction across +INSTRUCTIONS+
   do (setf (gethash (list (string (instruction-mnemonic instruction))
                           (string (operand-name (aref-or-nil (instruction-operands instruction) 0)))
                           (if (operand-immediate (aref-or-nil (instruction-operands instruction) 0)) 1 0)
                           (string (operand-name (aref-or-nil (instruction-operands instruction) 1)))
                           (if (operand-immediate (aref-or-nil (instruction-operands instruction) 1)) 1 0))
                     *instruction-map*) instruction))

(defun parse-instruction (instruction)
  (destructuring-bind (operand &optional destination source)
      (mapcar #'string-upcase (split-string instruction))
    (let
        ((destination-immediate (if (or (not destination)
                                        (string= (subseq destination 0 1) #\()) 0 1))
         (source-immediate (if (or (not source)
                                   (string= (subseq source 0 1) #\()) 0 1)))
      (list operand
            (string-trim '(#\( #\)) (string destination))
            destination-immediate
            (string-trim '(#\( #\)) (string source))
            source-immediate))))

(defun flatten (L)
  "Converts a list to single level."
  (if (null L)
      nil
      (if (atom (first L))
          (cons (first L) (flatten (rest L)))
          (append (flatten (first L)) (flatten (rest L))))))

(defun assemble (source &optional (pad 1))
  (let* ((lines (split-string source :separator '(#\Newline)))
         (text  (flatten (loop for line in lines
                            for instruction = (gethash (parse-instruction line) *instruction-map*)
                            for position = (instruction-position instruction)
                            for bytes = (instruction-bytes instruction)
                            collecting (concatenate 'list (list position)
                                                    (loop for i from 2 upto bytes collect 0))))))
    (make-array (+ (length text) pad) :element-type '(unsigned-byte 8)
                :initial-contents (concatenate 'list text (loop for i from 1 to pad collecting 0)))))
